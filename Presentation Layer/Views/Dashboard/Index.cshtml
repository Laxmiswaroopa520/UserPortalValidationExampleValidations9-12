 @model IEnumerable<UserPortalValdiationsDBContext.Models.User>

@{
    ViewBag.Title = "Dashboard";
}

<h2 class="mb-4 fw-bold">📊 User Dashboard</h2>

<!-- 🔹 TOP WIDGETS -->
<div class="row g-4 mb-4">

    <div class="col-md-4">
        <div class="card shadow-sm h-100">
            <div class="card-body">
                @await Component.InvokeAsync("UserProfileSidebar")
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm h-100">
            <div class="card-body text-center">
                @await Component.InvokeAsync("DepartmentCount")
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-warning text-dark">
                🎂 Birthdays This Month
            </div>
            <div class="card-body">
                @await Component.InvokeAsync("BirthdayCarousel")
            </div>
        </div>
    </div>


</div>

<!-- 🔹 DEPARTMENT BAR CHART -->
<div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">👥 Users by Department</h5>
        <small>Click a bar to filter users below</small>
    </div>
    <div class="card-body">
        @await Component.InvokeAsync("DepartmentChart")
    </div>
</div>

<!-- 🔹 ACTION BAR -->
<div class="mb-3 d-flex justify-content-between align-items-center">
    <a class="btn btn-success"
       asp-controller="Account"
       asp-action="Register">
        ➕ Add New User
    </a>

    <form asp-controller="Account"
          asp-action="Logout"
          method="post">
        <button type="submit" class="btn btn-danger">
            🔒 Logout
        </button>
    </form>
</div>

<!-- 🔹 USERS TABLE -->
<div class="card shadow-sm">
    <div class="card-header bg-dark text-white">
        <h5 class="mb-0">📋 User List</h5>
    </div>

    <div class="card-body p-0">
        <table class="table table-striped table-bordered align-middle mb-0">
            <thead class="table-dark">
                <tr>
                    <th>Id</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Age</th>
                    <th>Phone</th>
                    <th style="width: 280px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var u in Model)
                {
                    <tr data-department="@u.Department">
                        <td>@u.Id</td>
                        <td>@u.Username</td>
                        <td>@u.Email</td>
                        <td>@u.Age</td>
                        <td>@u.Phone</td>
                        <td>
                            <a class="btn btn-sm btn-primary"
                               asp-action="Edit"
                               asp-route-id="@u.Id">✏️ Edit</a>

                            <a class="btn btn-sm btn-info text-white"
                               asp-action="AddAddress"
                               asp-route-userId="@u.Id">🏠 Address</a>

                            <a class="btn btn-sm btn-secondary"
                               asp-action="UserAddresses"
                               asp-route-userId="@u.Id">📋 Addresses</a>

                            <a class="btn btn-sm btn-danger"
                               href="javascript:void(0)"
                               onclick="showDelete('@Url.Action("Delete", "Dashboard", new { id = u.Id })')">
                                🗑 Delete
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@await Html.PartialAsync("_DeletePopup")

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}

